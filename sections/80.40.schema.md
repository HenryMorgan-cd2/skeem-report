## The Schema

- what is it

  - models

- attributes
  - an attribute in the abstract simply comprises of a set of simple methods get, set, migrate.
    - these are then
  - simple types such as string, date, number, boolean
  - skeem offers more complex types
    - These types are where skeem really shines
    - association
    - file
      - see the chapter on file manager for more specifics as to how the files get processed and stored

The schema is a single JSON object with three main parts: db, models, and providers.

```{.json caption="The empty schema."}
{
  "db": {
    "functions": [],
    "tables": []
  },
  "models": [],
  "providers": []
}
```

### Db

The db section stores the current structure of the database. Its predominant use is storing the definition of all tables with names, columns, indexes and constraints.

```{.json caption="The schema definition of a table"}
{
  "name": string
  "columns": IColumn[]
  "indexes": IIndex[]
  "triggers": ITrigger[]
}
```

Also contained is a list of all custom functions, each having a name, language, and code body. Custom functions allow for complex functionality to be abstracted into the database itself. Skeem uses a custom function in order to properly format its results when paginated this function however is not stored within the schema as it is not application specific.

The functions are an experimental addition and as of the time of writing, no public features exist which utilize these functions.

### Models

Each model has a globally unique name used to identify it. This is the name that is passed the requests when referencing a model.

Models also store a tableName field, this references a particular table stored in the schemas `db` object. The tableName is independent of the name of the model, though when created they use the same value, as it allows the model to be renamed without having to alter the database and any references to the given table.

> :comment TODO

Attributes, scopes and permissions are complex in and of themselves, and therefore will be discussed further in a future section.

When the private field is true, Skeem will prevent querying the model directly. Instead the only way to access the model is through an association. This one done as skeem does not support polymorphic associations (an association that leads to one of multiple different models). Therefore, it is not possible to create accurate permissions in certain circumstances. For instance, if you had a model for storing addresses, and you wanted to use this same model for many other models (e.g for users and for properties), then you would want the permissions to be: users can only access their own address or those used for properties. Since you cannot create an association from addresses to the other models their is no way to determine if the address is used for properties, therefore by setting the model to private you avoid the issue as you would need access to a joined record to access an address.

The `live` and `callbacks` keys store information pertaining to features which are currently a work in progress.

Callbacks allow for actions to be taken after certain events, such as send an email when a new record is created or perform a mutation before mutating a record. These callbacks will greatly increase Skeems flexibility but as of yet they are in the testing stage before being released.

Live records utilize web sockets to inform the client of when records change. From the client, developers are able to subscribe to a given fetch query and then have a callback triggered when the results of that query update. This allows for views to always display the most accurate information and also enables applications such as real-time messengers. This feature is currently hidden behind a flag, as further testing needs to be done and more thought put into the client API before it could be released publicly. A proof of concept has been created and results have been extremely positive.

```{.json caption="The schema definition of a model."}
{
  "name": string
  "tableName": string
  "attributes": IAttribute[]
  "scopes": IScope[]
  "permissions"?: { [roleName: string]: IPermission }
  "private"?: boolean
  "live"?: { enabled: boolean }
  "callbacks"?: IModelCallback[]
}
```

### providers

> :comment TODO: the providers stores a list of available

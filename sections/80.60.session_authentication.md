> :comment TODO

## Sessions and Authentication {#permissions_sec}

These methods of authentication are referred to generally as session providers (they provide methods for authentication sessions).

Session provides define a name, model, a type and some configuration dependant on the type selected.

The **name** is used purely to distinguish between different providers and allows for multiple authentication strategies of the same type. You may have to distinct user sets which are authenticated with different models e.g for a school system you may have one user set named teachers and another for pupils.
The model defines where the session provider should look to find the necessary data to check against any credentials provided.

The **type** defines which session provider to use. Skeem comes with three built in providers: local, facebook, and google.

The local provide authenticates users by storing some identifying attribute and a password in the database itself. Then when an authentication request is made the database is queried for a record with the specified credentials. If a record is found then skeem authenticates the user as that record. The user attribute is most commonly an email address or a username. The password is stored securely using a secure hashing algorithm.

The Facebook and Google providers allow users to authenticate using these services via the familiar "login with XXX" buttons. These providers can specify a list of attributes to extract from the service such as name, email, image.

- Providers
  - What are they
- Local Provider
  - what it is
  - how it works
- Oauth Providers
  - built in ones
- once authenticated a session token is generated which is used to identify. this is encrypted with a secret key using the JSON web token standatd

- Permissions and their structure in the schema

### Roles and Permissions

Roles consist of a name and a query. The name is a globally unique value identifying what the role is called, such as "admin". The query takes the form of an operator tree which is executed in the context of the model holding the user information. If the operator is truthy then the current user has that role.

Each model can define a set of permissions. Each permissions lists what role they relate to, what action the permission is for (fetching, updating, creating, etc.) and also an operator tree defining what records can be accessed by the role.

Processing permissions for a model starts by selecting all the relevant operator trees which pertain the current users roles. If _all_ of the permission scope is explicitly false, then the query is aborted an an empty result set is returned. If _any_ of the scopes are explicitly true then the permissions are skipped as the user has access to all the records. Finally if neither of these conditions are met then the false values are filtered out of the scopes (false or X = X) and the remaining values are combined with the `or` operator and appended to the queries filters.
